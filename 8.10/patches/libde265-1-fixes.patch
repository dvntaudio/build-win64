From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Thu, 14 Mar 2019 14:00:00 +0200
Subject: [PATCH 1/2] Fix build errors + add install targets


diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1111111..2222222 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -66,3 +66,12 @@ endif()
 add_subdirectory (libde265)
 add_subdirectory (dec265)
 add_subdirectory (enc265)
+
+set(prefix ${CMAKE_INSTALL_PREFIX})
+set(exec_prefix "\${prefix}/bin")
+set(libdir "\${prefix}/lib")
+set(includedir "\${prefix}/include")
+set(VERSION ${PACKAGE_VERSION})
+
+configure_file(libde265.pc.in libde265.pc @ONLY)
+install(FILES ${CMAKE_BINARY_DIR}/libde265.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
diff --git a/dec265/CMakeLists.txt b/dec265/CMakeLists.txt
index 1111111..2222222 100644
--- a/dec265/CMakeLists.txt
+++ b/dec265/CMakeLists.txt
@@ -16,7 +16,7 @@ if(MSVC)
   )
 endif()
 
-if(NOT MSVC)
+if(NOT WIN32)
   # hdrcopy uses internal APIs that are not available when compiled for Windows
   add_executable (hdrcopy hdrcopy.cc)
 
diff --git a/libde265/CMakeLists.txt b/libde265/CMakeLists.txt
index 1111111..2222222 100644
--- a/libde265/CMakeLists.txt
+++ b/libde265/CMakeLists.txt
@@ -43,6 +43,8 @@ set (libde265_headers
   bitstream.h
   cabac.h
   configparam.h
+  de265.h
+  de265-version.h
   deblock.h
   decctx.h
   dpb.h
@@ -73,7 +73,7 @@ set (libde265_headers
   vui.h
 )
 
-if(MSVC)
+if(MSVC OR MINGW)
   set (libde265_sources
     ${libde265_sources}
     ../extra/win32cond.c
@@ -91,6 +91,10 @@ if(SUPPORTS_SSE4_1)
 endif()
 
 add_library(${PROJECT_NAME} SHARED ${libde265_sources} ${ENCODER_OBJECTS} ${X86_OBJECTS})
+set_target_properties(${PROJECT_NAME} PROPERTIES
+    PREFIX ""
+    IMPORT_PREFIX ""
+)
 target_link_libraries(${PROJECT_NAME} PRIVATE Threads::Threads)
 
 write_basic_package_version_file(${PROJECT_NAME}ConfigVersion.cmake COMPATIBILITY ExactVersion)
 
From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 20011
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Sun, 16 Feb 2020 19:00:00 +0100
Subject: [PATCH 2/2] Apply SSE flags to x86 builds as well


diff --git a/libde265/x86/CMakeLists.txt b/libde265/x86/CMakeLists.txt
index 1111111..2222222 100644
--- a/libde265/x86/CMakeLists.txt
+++ b/libde265/x86/CMakeLists.txt
@@ -18,6 +18,4 @@ endif()
 
 set(X86_OBJECTS $<TARGET_OBJECTS:x86> $<TARGET_OBJECTS:x86_sse> PARENT_SCOPE)
 
-if(CMAKE_SYSTEM_PROCESSOR STREQUAL "x86_64")
-  SET_TARGET_PROPERTIES(x86_sse PROPERTIES COMPILE_FLAGS "${sse_flags}")
-endif(CMAKE_SYSTEM_PROCESSOR STREQUAL "x86_64")
+SET_TARGET_PROPERTIES(x86_sse PROPERTIES COMPILE_FLAGS "${sse_flags}")
